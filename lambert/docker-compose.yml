version: "3.4"
services:
  homeassistant:
    image: homeassistant/home-assistant:2025.10
    restart: unless-stopped
    volumes:
      - ./etc/home-assistant:/config
    depends_on:
      - mosquitto
      - zigbee2mqtt
    environment:
      - TZ=America/Montreal
    # labels:
    #   - "traefik.enable=true"
    #   - "traefik.http.routers.ha.rule=Host(`tbd.f1961.nmac.com.ar`)"
    #   - "traefik.http.services.ha.loadbalancer.server.port=8123"
    #   - "traefik.http.routers.ha.tls.certresolver=lets-encr"
    #   - "traefik.http.routers.ha.tls.domains[0].main=ha.f1961.nmac.com.ar"
    ports:
      - "8123:8123"

  mosquitto:
    image: ansi/mosquitto
    restart: unless-stopped
    ports:
      - 1883:1883
    entrypoint: /usr/local/sbin/mosquitto -c /etc/mosquitto/mosquitto.conf
    volumes:
      - ./etc/mosquitto:/etc/mosquitto:ro
      - ./var/lib/mosquitto/mosquitto.db:/var/lib/mosquitto/mosquitto.db:rw
    environment:
      - TZ=America/Montreal

  nginx:
    image: nginx
    restart: unless-stopped
    ports:
      - 8125:8125
    volumes:
      - ./etc/nginx/homeassistant.conf:/etc/nginx/conf.d/homeassistant.conf
      - ./etc/nginx/querini.homeassistant.conf:/etc/nginx/conf.d/querini.homeassistant.conf
      - ./etc/certificates:/etc/certificates
    depends_on:
      - homeassistant
    # labels:
    #   - "traefik.http.routers.homeassistant.rule=Host(`hanginx.f1961.nmac.com.ar`)"
    #   - "traefik.http.services.homeassistant.loadbalancer.server.port=8124"
    #   - "traefik.http.routers.querinihomeassistant.rule=Host(`querini.f1961.nmac.com.ar`)"
    #   - "traefik.http.services.querinihomeassistant.loadbalancer.server.port=8125"


  cloud9: # https://hub.docker.com/r/sapk/cloud9/
    image: linuxserver/cloud9
    restart: unless-stopped
    privileged: true
    volumes:
    - ./:/code/homeassistant
    - ./zoneminder:/code/zoneminder
    - ./wireguard:/code/wireguard
    - /var/run/docker.sock:/var/run/docker.sock
    environment:
    - PGID=1000
    - TZ=America/Montreal
    - GITURL=https://github.com/linuxserver/docker-cloud9.git
    ports:
    - "8000:8000"
    labels:
    - "com.centurylinklabs.watchtower.enable=true"

  logs:
    image: gerchardon/docker-logio
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    command: -h logio -n docker
    depends_on:
      - logio

  logio:
    image: temal/logio-server
    ports:
      - 9002:28778

  duckdns:
    image: linuxserver/duckdns:amd64-version-d3a93533
    restart: unless-stopped
    volumes:
    - ./etc/duckdns/token/token:/config/token/token
    environment:
    - PUID=1000 #optional
    - PGID=1000 #optional
    - TZ=America/Montreal
    - SUBDOMAINS=micasanmaca
    - LOG_FILE=false
    # - FILE__TOKEN=/config/token/token
    env_file:
    - ./etc/duckdns/token/env_token
    
  tasmoadmin:
    image: raymondmm/tasmoadmin
    volumes:
    - ./volumes/tasmoadmin/data:/data
    ports:
    - 9003:80

  zigbee2mqtt:
    image: koenkk/zigbee2mqtt:1.35.2
    # Was 1.25.1
    privileged: true
    restart: always
    volumes:
      - ./volumes/zigbee2mqtt/data:/app/data
      - /dev/ttyUSB0:/dev/ttyUSB0
      - /run/udev:/run/udev:ro
    environment:
    - TZ=America/Montreal
